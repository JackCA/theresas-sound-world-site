/* Theresa's Sound World site 0.0.1 (c) 2013 Stuart Memo */
(function(e,t){var r=function(){var e=function(){if("undefined"==typeof webkitAudioContext&&"undefined"==typeof AudioContext){if(webkitAudioContext.prototype.createGainNode===t)throw Error("Sorry, your browser doesn't support a recent enough version of the Web Audio API.");webkitAudioContext.prototype.createGain=webkitAudioContext.prototype.createGainNode,webkitAudioContext.prototype.createScriptProcessor=webkitAudioContext.prototype.createJavaScriptNode}else this.context="function"==typeof AudioContext?new AudioContext:new webkitAudioContext;this.version="0.0.1",this.speakers=this.context.destination,this.processors=[]};e.isBrowserCompatible=function(){return!0},e.now=function(){return this.context.currentTime};var r=function(e,t){for(attr in t)e[attr]=t[attr];return e};return e.applySettings=function(e,t){for(setting in t)e[setting].value=t[setting]},e.connect=function(){for(var e=0;arguments.length-1>e;e++)if(Array.isArray(arguments[e]))for(var t=0;arguments[e].length>t;t++)this.connect(arguments[e][t],arguments[e+1]);else arguments[e].hasOwnProperty("output")?arguments[e+1].hasOwnProperty("input")?arguments[e].output.connect(arguments[e+1].input):arguments[e].output.connect(arguments[e+1]):arguments[e+1].hasOwnProperty("input")?arguments[e].connect(arguments[e+1].input):arguments[e].connect(arguments[e+1])},e.disconnect=function(e){e.disconnect()},e.prototype.load=function(e,t){var r={},a=0,n=0,o=this,i=function(e,t,r,i){var s=new XMLHttpRequest;s.open("GET",t,!0),s.responseType="arraybuffer",s.onload=function(){a++,o.context.decodeAudioData(s.response,function(t){r[e]=o.context.createBufferSource(),r[e].buffer=t,r[e].play=function(){o.play(this)},r[e].stop=function(){o.stop(this)},r[e].isPlaying=function(){return this.playbackState},a===n&&i(r)})},s.send()};if("object"==typeof e)for(var s in e)n++,i(s,e[s],r,t);else{if("string"!=typeof e)throw Error("Files must be an array or a valid string.");n=1,i(s,e[s],r,t)}},e.prototype.play=function(e){e.start(0)},e.prototype.stop=function(e){e.stop(0)},e.prototype.reverse=function(e){for(var t=0;e.buffer.numberOfChannels>t;t++)Array.prototype.reverse.call(e.buffer.getChannelData(t));return e},e.prototype.createOscillator=function(e,r){var a=this.context.createOscillator();return a.start===t&&(a.start=a.noteOn,a.stop=a.noteOff),e=e||"SINE",e=e.toUpperCase(),a.type=a[e],a.safariType=e.toLowerCase(),a.frequency.value=r||440,a},e.prototype.createGain=function(e){var t;return t="function"==typeof this.context.createGain?this.context.createGain():this.context.createGainNode(),t.gain.value=e||1,t},e.prototype.createBuffer=function(){var e=this.context.createBuffer(1,65536,44100);return e},e.prototype.createBufferSource=function(e){var t=this.context.createBufferSource();return t.buffer=e,t},e.prototype.createFilter=function(e){var t=e||"lowpass",r=this.context.createBiquadFilter();return r.type=t,r},e.prototype.createAnalyser=function(){return this.context.createAnalyser()},e.createCompressor=function(e){var t=this.context.createDynamicsCompressor(),a={threshold:-24,knee:30,ratio:12,attack:.003,release:.25};return e=r(a,e),this.applySettings(t,e),t},e.createProcessor=function(e,t){var r=e||1024,a=tsw.context.createScriptProcessor(r,1,1);return"function"==typeof t&&(a.onaudioprocess=function(e){t(e)}),a},e.createWaveShaper=function(){for(var e=new Float32Array(65536),t=0;32768>t;t++)e[t]=3e4>t?.1:-1;var r=this.context.createWaveShaper();return r.curve=e,r},e.createEnvelope=function(e){var r={};return r.startLevel=e.startLevel||0,r.maxLevel=e.maxLevel||1,r.minLevel=e.minLevel||0,r.attackTime=e.attackTime||0,r.decayTime=e.decayTime||0,r.sustainLevel=e.sustainLevel||0,r.releaseTime=e.releaseTime||0,r.param=e.param,r.param.value=r.startLevel,r.autoRelease=e.autoRelease===t?!0:e.autoRelease,r.start=function(e){this.maxLevel=this.startLevel+this.maxLevel,this.sustainLevel=this.startLevel+this.sustainLevel,this.startTime=e||tsw.now(),this.attackTime=this.startTime+this.attackTime,this.decayTime=this.attackTime+this.decayTime,this.releaseTime=this.decayTime+this.releaseTime,this.param.cancelScheduledValues(this.startTime),this.param.setValueAtTime(this.startLevel,this.startTime),this.param.linearRampToValueAtTime(this.maxLevel,this.attackTime),this.param.linearRampToValueAtTime(this.startLevel+this.sustainLevel,this.decayTime),this.autoRelease&&(this.param.linearRampToValueAtTime(this.minLevel,this.releaseTime),this.stop(this.releaseTime))},r.stop=function(e){e=e||tsw.now(),e+=this.releaseTime,this.autoRelease||this.param.linearRampToValueAtTime(this.startLevel,e)},r},e.createNoise=function(){for(var e,t=this.createbuffer(),r=0;65536>r;r++)t.getChannelData(0)[r]=2*Math.random()-1;return e=this.createBufferSource(t),e.loop=!0,e},e.createLFO=function(e){var t=tsw.createOscillator(),a=this.createGain(),n={frequency:0,waveType:"triangle",depth:1,target:null,autoStart:!1};return e=r(n,e),t.type=t[e.waveType]||t.TRIANGLE,a.gain.value=e.depth,t.frequency.value=e.frequency,e.autoStart&&t.start(tsw.now()),t.modulate=function(e){this.connect(a),a.connect(e)},t.setWaveType=function(e){t.type=t[e.toUpperCase()]},t.setFrequency=function(e){t.frequency.value=e},t.setDepth=function(e){a.gain.value=e},t.modulate(e.target),t},e}();e.tsw=new r})(window);