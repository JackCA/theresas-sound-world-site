/* Theresa's Sound World 0.0.1 (c) 2013 Stuart Memo */
window.tsw=function(a,b){"use strict";var c=function(a,b){for(var c in b)a[c]=b[c];return a},d=function(a,b){for(var c in b)a[c].value=b[c]},e=function(a){return Array.isArray(a)},f=function(a){var b=!1;return Object(a)&&"node"in a&&(b=!0),b},g=function(a){return"undefined"!=typeof a.context},h=function(a){return a.hasOwnProperty("input")||a.hasOwnProperty("output")},i={},j=[];i.version="0.0.1",i.processors=[],i.isBrowserCompatible=!1;var k=function(){i.noise_buffer=i.createBuffer();for(var a=0;a<i.noise_buffer.length;a++)i.noise_buffer.getChannelData(0)[a]=2*Math.random()-1},l=function(a,b){if("undefined"==typeof webkitAudioContext&&"undefined"==typeof AudioContext)if("undefined"==typeof webkitAudioContext.prototype.createGainNode)b("Sorry, your browser doesn't support a recent enough version of the Web Audio API.");else{var c=webkitAudioContext.prototype;c.createGain=c.createGainNode,c.createDelay=c.createDelayNode,c.createScriptProcessor=c.createJavaScriptNode}else i.context="function"==typeof AudioContext?new AudioContext:new webkitAudioContext;i.browserSupported=!0,a()},m=function(){i.speakers=i.context.destination};i.now=function(){return this.context.currentTime},i.createChannelMerger=function(a){return i.context.createChannelMerger(a)},i.connect=function(){for(var a=function(){arguments[0].connect(arguments[1])},b=function(){arguments[0].connect(arguments[1].input)},c=function(){for(var a=0;a<arguments[1].length;a++)i.connect(arguments[0],arguments[1][a])},d=function(){for(var a=0;a<arguments[0].length;a++)i.connect(arguments[0][a],arguments[1])},j=function(){arguments[0].output.connect(arguments[1])},k=function(){for(var a=0;a<arguments[0].length;a++)this.connect(arguments[0][a],arguments[1])},l=function(){for(var a=0;a<arguments[0].length;a++)this.connect(arguments[0][a],arguments[1])},m=function(){arguments[0].node.connect(arguments[1].node,arguments[0].channel,arguments[1].channel)},n=0;n<arguments.length-1;n++){var o=arguments[n],p=arguments[n+1];g(o)&&h(p)?b(o,p):h(o)&&g(p)?j(o,p):g(o)&&e(p)?c(o,p):e(o)&&g(p)?d(o,p):g(o)&&g(p)?a(o,p):h(o)&&h(p)?connectTswNode(o,p):h(o)&&e(p)?connectTswNodeToArray(o,p):e(o)&&h(p)?k(o,p):e(o)&&e(p)?l(o,p):f(o)&&e(p)?connectObjectWithNodeToArray(o,p):e(o)&&f(p)?connectArrayToObjectWithNode(o,p):f(o)&&f(p)&&m(o,p)}},i.disconnect=function(){for(var a=arguments.length,b=0;a>b;b++)arguments[b].disconnect()},i.disconnectAfterTime=function(a,b){j.push({node:a,time:b})},i.load=function(){var a,b={},c=arguments[0],d="",e=[],f=0,g=0,h=this,i=function(a,b,c,d,e){var i=new XMLHttpRequest;i.open("GET",a+c,!0),i.responseType="arraybuffer",i.onload=function(){f++,h.context.decodeAudioData(i.response,function(a){d[b]=a,f===g&&e(d)})},function(a){console.log("Error decoding audio data",a)},i.send()};if("object"==typeof arguments[1]?(d=arguments[1].path||"",e=arguments[1].extensions||[]):"function"==typeof arguments[1]&&(a=arguments[1]),"function"==typeof arguments[2]&&(a=arguments[2]),"object"==typeof c)for(var j in c)g++,i(d,j,c[j],b,a);else{if("string"!=typeof c)throw new Error("Files must be an array or a valid string.");g=1,i(d,j,c[j],b,a)}},i.createDelay=function(a){var b=this.context.createDelay();return b.delayTime.value=a||0,b},i.createMonoMaker=function(){var a={};return a.input=i.createGain(),a.output=i.createGain(),i.connect(a.input,a.output),a},i.createPanner=function(a){var b={},c=i.createGain(1),d=i.createGain(0),e=i.createChannelMerger(2);return b.input=i.createGain(),b.output=i.createGain(),b.value=a,b.value>1?b.value=1:b.value<-1&&(b.value=-1),c.gain.value=1-100*.01*((1+b.value)/2),d.gain.value=1-c.gain.value,i.connect(b.input,[c,d]),i.connect({node:c,channel:0},{node:e,channel:0}),i.connect({node:d,channel:0},{node:e,channel:1}),i.connect(e,b.output),b},i.play=function(a,b){b=b||0,a.start(b)},i.stop=function(a,b){b=b||0,a.stop(b)},i.reverse=function(a){for(var b=0;b<a.buffer.numberOfChannels;b++)Array.prototype.reverse.call(a.buffer.getChannelData(b));return a},i.createOscillator=function(a,b){var c=this.context.createOscillator();return"undefined"==typeof c.start&&(c.start=c.noteOn,c.stop=c.noteOff),a=a||"SINE",a=a.toUpperCase(),c.type=c[a],c.safariType=a.toLowerCase(),c.frequency.value=b||440,c},i.createGain=function(a){var b;return b="function"==typeof this.context.createGain?this.context.createGain():this.context.createGainNode(),b.gain.value=a||1,b},i.createBuffer=function(a,b,c){return a=a||1,b=b||65536,c=c||44100,this.context.createBuffer(a,b,c)},i.createBufferSource=function(a){var b=this.context.createBufferSource();return b.buffer=a,"undefined"==typeof b.start&&(b.start=b.noteOn,b.stop=b.noteOff),b},i.createFilter=function(a,b,c){var d=a||"lowpass",e=this.context.createBiquadFilter();return e.type=d,e.frequency.value=b||0,e.Q.value=c||0,e},i.createAnalyser=function(){return this.context.createAnalyser()},i.createCompressor=function(a){var b=this.context.createDynamicsCompressor(),e={threshold:-24,knee:30,ratio:12,attack:.003,release:.25};return a=c(e,a),d(b,a),b},i.createProcessor=function(a,b){var c=a||1024,d=i.context.createScriptProcessor(c,1,1);return"function"==typeof b&&(d.onaudioprocess=function(a){b(a)}),d},i.createWaveShaper=function(){for(var a=new Float32Array(65536),b=0;32768>b;b++)a[b]=3e4>b?.1:-1;var c=this.context.createWaveShaper();return c.curve=a,c},i.createEnvelope=function(a){var c={};return a=a||{},c.startLevel=a.startLevel||0,c.maxLevel=a.maxLevel||1,c.minLevel=a.minLevel||0,c.attackTime=a.attackTime||0,c.decayTime=a.decayTime||0,c.sustainLevel=a.sustainLevel||0,c.releaseTime=a.releaseTime||0,c.param=a.param||{},c.param.value=c.startLevel,c.autoStop=a.autoStop===b?!0:a.autoStop,c.start=function(a){this.maxLevel=this.startLevel+this.maxLevel,this.sustainLevel=this.startLevel+this.sustainLevel;var b=a||i.now(),c=b+this.attackTime,d=c+this.decayTime,e=d+this.releaseTime;this.param.cancelScheduledValues(b),this.param.setValueAtTime(this.startLevel,b),this.param.linearRampToValueAtTime(this.maxLevel,c),this.param.linearRampToValueAtTime(this.startLevel+this.sustainLevel,d),this.autoStop&&(this.param.linearRampToValueAtTime(this.minLevel,e),this.stop(e))},c.stop=function(a){a=a||i.now(),a+=this.releaseTime,this.autoStop||this.param.linearRampToValueAtTime(this.minLevel,this.releaseTime)},c},i.createNoise=function(){var a=this.createBufferSource(i.noise_buffer);return a.loop=!0,a},i.createLFO=function(a){var b=i.createOscillator(),d=this.createGain(),e={frequency:0,waveType:"triangle",depth:1,target:null,autoStart:!1};return a=c(e,a),b.type=b[a.waveType]||b.TRIANGLE,d.gain.value=a.depth,b.frequency.value=a.frequency,a.autoStart&&b.start(i.now()),b.modulate=function(a){this.connect(d),d.connect(a)},b.setWaveType=function(a){b.type=b[a.toUpperCase()]},b.setFrequency=function(a){b.frequency.value=a},b.setDepth=function(a){d.gain.value=a},b.modulate(a.target),b},i.getUserAudio=function(a){var b=function(b){var c=i.context.createMediaStreamSource(b);a(c)};navigator.webkitGetUserMedia({audio:!0},b)};var n=function(){!function a(){j.forEach(function(a){a.time<i.now()&&i.disconnect(a.node)}),setTimeout(a,500)}()};return function(){l(function(){m(),k(),n()},function(a){console.log(a)})}(),i}(window),function(){"use strict";var a=a||{};a.createDelay=function(b){var c={},d=a.context.createDelay(),e=a.context.createGain(),f=a.context.createGain(),g=a.createGain();return c.input=a.createGain(),c.output=a.createGain(),c.settings={delayTime:.5,feedback:.5,effectLevel:.5},b=b||{},d.delayTime.value=b.delayTime||c.settings.delayTime,e.gain.value=b.feedback||c.settings.feedback,f.gain.value=b.effectLevel||c.settings.effectLevel,a.connect(c.input,g,d,e,d,f,c.output),a.connect(g,d),c},a.createDistortion=function(b){var c={},d=a.context.createWaveShaper(),e=a.context.createBiquadFilter(),f=a.context.createBiquadFilter();return c.settings={distortionLevel:.5},b=b||{},c.input=a.createGain(),c.output=a.createGain(),a.connect(c.input,d,[e,f],c.output),c},a.createFlanger=function(){var a={};return a},a.createPhaser=function(b){var c={},d=[],e=a.createGain(),f={rate:8,depth:.5,feedback:.8};b=b||{},e.gain.value=b.gain||f.gain;for(var g=0;g<config.rate;g++)d[g]=a.context.createBiquadFilter(),d[g].type=7,d[g].frequency.value=100*g;c.input=a.createGain(),c.output=a.createGain();for(var g=0;g<d.length-1;g++)a.connect(d[g],d[g+1]);return a.connect(c.input,d[0],d[d.length-1],e,d[0]),a.connect(d[d.length-1],c.output),c.setCutoff=function(){for(var a=0;a<d.length;a++);},c},a.createReverb=function(b){var c=a.context.createConvolver(),d=a.createGain(),e={},f={effectLevel:.5,reverbTime:.5,reverbType:"spring",reverbPath:""};return b=b||{},d.gain.value=b.effectLevel||f.effectLevel,a.load({hall:"/effects/reverb/responses/bright-hall.wav",room:"/effects/reverb/responses/medium-room.wav",spring:"/effects/reverb/responses/feedback-spring.wav"},function(b){f.reverbPath=b[f.reverbType],c.buffer=f.reverbPath,e.input=a.createGain(),e.output=a.createGain(),a.connect(e.input,[e.output,c]),a.connect(c,d),a.connect(d,e.output)}),e},a.createTremolo=function(b){var c={},d=(a.createGain(),this.createLFO()),e=this;return b=b||{},c.input=a.createGain(),c.connect=function(a){c.input.connect(a),d.modulate(c.input.gain),d.start(e.now())},c.setRate=function(a){d.setFrequency(a)},c.setDepth=function(a){d.setDepth(a)},c}}(window),function(){"use strict";var a=["A","A#","B","C","C#","D","D#","E","F","F#","G","G#"];a.push.apply(a,a);var b=["unison","flat 2nd","2nd","minor 3rd","major 3rd","perfect 4th","flat 5th","perfect 5th","minor 6th","major 6th","minor 7th","major 7th","octave","flat 9th","9th","sharp 9th","major 10th","11th","augmented 11th","perfect 12th","flat 13th","13th"],c=function(b){for(var c,d=a.length,e=0;d>e;e++)if(b.toUpperCase()===a[e])return c=e,e;return null},d=function(b){var d=[],e=c(b);return d.push(a[e]),d.push(a[e+2]),d.push(a[e+4]),d.push(a[e+5]),d.push(a[e+7]),d.push(a[e+9]),d.push(a[e+11]),d.push(a[e+12]),d},e=function(b){var d=[],e=c(b);return d.push(a[e]),d.push(a[e+2]),d.push(a[e+3]),d.push(a[e+5]),d.push(a[e+7]),d.push(a[e+8]),d.push(a[e+10]),d.push(a[e+12]),d};tsw.parseChord=function(b){var d={},e=[],f=0;return Array.isArray(b)?!1:(b=b.toLowerCase(),d.rootNote=b[0].toUpperCase(),d.isMajor=b.indexOf("maj")>-1,d.isMinor=!d.isMajor&&b.indexOf("m")>-1,d.is7th=b.indexOf("7")>-1,d.notes=[],d.is7th||(d.octave=b.match(/\d/g)),d.isMajor||d.isMinor?(f=c(d.rootNote),e.push(f),b.isMinor?e.push(f+tsw.getSemitoneDifference("minor 3rd")):e.push(f+tsw.getSemitoneDifference("major 3rd")),e.push(f+tsw.getSemitoneDifference("perfect 5th")),e.push(f+tsw.getSemitoneDifference("octave")),e.forEach(function(b){d.notes.push(a[b])}),d.notes):!1)},tsw.getScale=function(a,b){return"minor"===b?e(a):d(a)},tsw.getSemitoneDifference=function(a){for(var c=b.length,d=0;c>d;d++)if(a===b[d])return d},tsw.isChord=function(a){return this.parseChord(a)},tsw.chordToNotes=function(a){return a=this.parseChord(a),a.notes},tsw.noteToFrequency=function(b){var c,d;return c=3===b.length?b.charAt(2):b.charAt(1),d=a.indexOf(b.slice(0,-1)),d=3>d?d+12+12*(c-1)+1:d+12*(c-1)+1,Math.round(440*Math.pow(2,(d-49)/12))}}(window),function(a){"use strict";var b=function(){var a=function(a){this.context=a};return a.prototype.getUserMIDI=function(a,b){navigator.requestMIDIAccess().then(a,b)},a.prototype.MIDINumberToNote=function(a){var b=a%12,c=Math.floor(a/12),d=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];return d[b]+c},a}();a.tsw.midi=new b}(window);