/* Theresa's Sound World 0.0.1 (c) 2013 Stuart Memo */
(function(t,e){var r=function(){var t=function(){if(webkitAudioContext.prototype.createGain===e){if(webkitAudioContext.prototype.createGainNode===e)throw Error("Sorry, your browser doesn't support a recent enough version of the Web Audio API.");webkitAudioContext.prototype.createGain=webkitAudioContext.prototype.createGainNode,webkitAudioContext.prototype.createScriptProcessor=webkitAudioContext.prototype.createJavaScriptNode}this.context=new webkitAudioContext,this.version="0.0.1",this.speakers=this.context.destination,this.processors=[]};t.prototype.now=function(){return this.context.currentTime};var r=function(t,e){for(attr in e)t[attr]=e[attr];return t};return t.prototype.applySettings=function(t,e){for(setting in e)t[setting].value=e[setting]},t.prototype.connect=function(){for(var t=0;arguments.length-1>t;t++)if(Array.isArray(arguments[t]))for(var e=0;arguments[t].length>e;e++)this.connect(arguments[t][e],arguments[t+1]);else arguments[t].hasOwnProperty("output")?arguments[t+1].hasOwnProperty("input")?arguments[t].output.connect(arguments[t+1].input):arguments[t].output.connect(arguments[t+1]):arguments[t+1].hasOwnProperty("input")?arguments[t].connect(arguments[t+1].input):arguments[t].connect(arguments[t+1])},t.prototype.disconnect=function(t){t.disconnect()},t.prototype.load=function(t,e){var r={},n=0,o=0,a=this,i=function(t,e,r,i){var s=new XMLHttpRequest;s.open("GET",e,!0),s.responseType="arraybuffer",s.onload=function(){n++,a.context.decodeAudioData(s.response,function(e){r[t]=a.context.createBufferSource(),r[t].buffer=e,r[t].play=function(){a.play(this)},r[t].stop=function(){a.stop(this)},r[t].isPlaying=function(){return this.playbackState},n===o&&i(r)})},s.send()};if("object"==typeof t)for(var s in t)o++,i(s,t[s],r,e);else{if("string"!=typeof t)throw Error("Files must be an array or a valid string.");o=1,i(s,t[s],r,e)}},t.prototype.play=function(t){t.start(0)},t.prototype.stop=function(t){t.stop(0)},t.prototype.reverse=function(t){for(var e=0;t.buffer.numberOfChannels>e;e++)Array.prototype.reverse.call(t.buffer.getChannelData(e));return t},t.prototype.createOscillator=function(t,r){var n=this.context.createOscillator();return n.start===e&&(n.start=n.noteOn,n.stop=n.noteOff),t=t||"SINE",t=t.toUpperCase(),n.type=n[t],n.safariType=t.toLowerCase(),n.frequency.value=r||440,n},t.prototype.createGain=function(t){var e;return e="function"==typeof this.context.createGain?this.context.createGain():this.context.createGainNode(),e.gain.value=t||1,e},t.prototype.createFilter=function(t){var e=t||"lowpass",r=this.context.createBiquadFilter();return r.type=e,r},t.prototype.createAnalyser=function(){return this.context.createAnalyser()},t.prototype.createCompressor=function(t){var e=this.context.createDynamicsCompressor(),n={threshold:-24,knee:30,ratio:12,attack:.003,release:.25};return t=r(n,t),this.applySettings(e,t),e},t.prototype.createProcessor=function(t,e){var r=t||1024,n=tsw.context.createScriptProcessor(r,1,1);return"function"==typeof e&&(n.onaudioprocess=function(t){e(t)}),n},t.prototype.createWaveShaper=function(){for(var t=new Float32Array(65536),e=0;32768>e;e++)t[e]=3e4>e?.1:-1;var r=this.context.createWaveShaper();return r.curve=t,r},t.prototype.createEnvelope=function(t){var r={};return r.startLevel=t.startLevel||0,r.maxLevel=t.maxLevel||1,r.minLevel=t.minLevel||0,r.attackTime=t.attackTime||0,r.decayTime=t.decayTime||0,r.sustainLevel=t.sustainLevel||0,r.releaseTime=t.releaseTime||0,r.param=t.param,r.param.value=r.startLevel,r.autoStop=t.autoStop===e?!0:t.autoStop,r.start=function(t){this.maxLevel=this.startLevel+this.maxLevel,this.sustainLevel=this.startLevel+this.sustainLevel,this.startTime=t||tsw.now(),this.attackTime=this.startTime+this.attackTime,this.decayTime=this.attackTime+this.decayTime,this.param.cancelScheduledValues(this.startTime),this.param.setValueAtTime(this.startLevel,this.startTime),this.param.linearRampToValueAtTime(this.maxLevel,this.attackTime),this.param.linearRampToValueAtTime(this.startLevel+this.sustainLevel,this.decayTime),this.autoStop&&this.stop(this.decayTime)},r.stop=function(t){t=t||tsw.now(),t+=this.releaseTime,this.param.linearRampToValueAtTime(this.startLevel,t)},r},t.prototype.createNoise=function(){var t=this.context.createScriptProcessor(1024,0,1);return t.onaudioprocess=function(t){for(var e=0;1024>e;e++)t.outputBuffer.getChannelData(0)[e]=2*Math.random()-1},t},t.prototype.createLFO=function(t){var e=tsw.createOscillator(),n=this.createGain(),o={frequency:0,waveType:"triangle",depth:1,target:null,autoStart:!1};return t=r(o,t),e.type=e[t.waveType]||e.TRIANGLE,n.gain.value=t.depth,e.frequency.value=t.frequency,t.autoStart&&e.start(tsw.now()),e.modulate=function(t){this.connect(n),n.connect(t)},e.setWaveType=function(t){e.type=e[t.toUpperCase()]},e.setFrequency=function(t){e.frequency.value=t},e.setDepth=function(t){n.gain.value=t},e.modulate(t.target),e},t}();t.tsw=new r})(window),function(t){var e=function(){var t=function(t){this.context=t};return t.prototype.createCompressor=function(t){var e={},r=tsw.context.createDynamicsCompressor();return e.input=tsw.context.createGain(),e.output=tsw.context.createGain(),e.settings=t||{},tsw.connect(e.input,r,e.output),e},t.prototype.createDelay=function(t){var e={},r=tsw.context.createDelay(),n=tsw.context.createGain(),o=tsw.context.createGain(),a=tsw.createGain();return e.input=tsw.createGain(),e.output=tsw.createGain(),e.settings={delayTime:.5,feedback:.5,effectLevel:.5},t=t||{},r.delayTime.value=t.delayTime||e.settings.delayTime,n.gain.value=t.feedback||e.settings.feedback,o.gain.value=t.effectLevel||e.settings.effectLevel,tsw.connect(e.input,a,r,n,r,o,e.output),tsw.connect(a,r),e},t.prototype.createDistortion=function(t){var e={},r=context.createWaveShaper(),n=context.createBiquadFilter(),o=context.createBiquadFilter();return e.settings={distortionLevel:.5},t=t||{},e.input=tsw.createGain(),e.output=tsw.createGain(),tsw.connect(e.input,r,[n,o],e.output),e},t.prototype.createFlanger=function(){var t={};return t},t.prototype.createPhaser=function(t){var e={},r=[],n=tsw.createGain(),o={rate:8,depth:.5,feedback:.8};t=t||{},n.gain.value=t.gain||o.gain;for(var a=0;config.rate>a;a++)r[a]=tsw.context.createBiquadFilter(),r[a].type=7,r[a].frequency.value=100*a;e.input=tsw.createGain(),e.output=tsw.createGain();for(var a=0;r.length-1>a;a++)tsw.connect(r[a],r[a+1]);return tsw.connect(e.input,r[0],r[r.length-1],n,r[0]),tsw.connect(r[r.length-1],e.output),e.setCutoff=function(){for(var t=0;r.length>t;t++);},e},t.prototype.createReverb=function(t){var e=tsw.context.createConvolver(),r=tsw.createGain(),n={},o={effectLevel:.5,reverbTime:.5,reverbType:"spring",reverbPath:""};return t=t||{},r.gain.value=t.effectLevel||o.effectLevel,tsw.load({hall:"/effects/reverb/responses/bright-hall.wav",room:"/effects/reverb/responses/medium-room.wav",spring:"/effects/reverb/responses/feedback-spring.wav"},function(t){o.reverbPath=t[o.reverbType],e.buffer=o.reverbPath,n.input=tsw.createGain(),n.output=tsw.createGain(),tsw.connect(n.input,[n.output,e]),tsw.connect(e,r),tsw.connect(r,n.output)}),n},t.prototype.createTremolo=function(t){var e={},r=(tsw.createGain(),this.createLFO()),n=this;return t=t||{},e.input=tsw.createGain(),e.connect=function(t){e.input.connect(t),r.modulate(e.input.gain),r.start(n.now())},e.setRate=function(t){r.setFrequency(t)},e.setDepth=function(t){r.setDepth(t)},e},t}();t.tsw.fx=new e}(window),function(t){var e=function(){var t=function(){this.context=tsw.context},e=["A","A#","B","C","C#","D","D#","E","F","F#","G","G#"];e.push.apply(e,e);var r=["unison","flat 2nd","2nd","minor 3rd","major 3rd","perfect 4th","flat 5th","perfect 5th","minor 6th","major 6th","minor 7th","major 7th","octave","flat 9th","9th","sharp 9th","major 10th","11th","augmented 11th","perfect 12th","flat 13th","13th"],n=function(t){for(var r=e.length,n=0;r>n;n++)if(t.toUpperCase()===e[n])return positionOnScale=n,n;return null},o=function(t){var r=[],o=n(t);return r.push(e[o]),r.push(e[o+2]),r.push(e[o+4]),r.push(e[o+5]),r.push(e[o+7]),r.push(e[o+9]),r.push(e[o+11]),r.push(e[o+12]),r};t.prototype.parseChord=function(t){var r={},o=[],i=0;return Array.isArray(t)?!1:(t=t.toLowerCase(),r.rootNote=t[0].toUpperCase(),r.isMajor=t.indexOf("maj")>-1,r.isMinor=!r.isMajor&&t.indexOf("m")>-1,r.is7th=t.indexOf("7")>-1,r.notes=[],r.is7th||(r.octave=t.match(/\d/g)),r.isMajor||r.isMinor?(i=n(r.rootNote),o.push(i),t.isMinor?o.push(i+a("minor 3rd")):o.push(i+a("major 3rd")),o.push(i+a("perfect 5th")),o.push(i+a("octave")),o.forEach(function(t){r.notes.push(e[t])}),r):!1)},t.prototype.getScale=function(t){return o(t)};var a=function(t){for(var e=r.length,n=0;e>n;n++)if(t===r[n])return n};return t.prototype.isChord=function(t){return this.parseChord(t)},t.prototype.chordToNotes=function(t){return t=this.parseChord(t),t.notes},t.prototype.noteToFrequency=function(t){var r,n;return r=3===t.length?t.charAt(2):t.charAt(1),n=e.indexOf(t.slice(0,-1)),n=3>n?n+12+12*(r-1)+1:n+12*(r-1)+1,Math.round(440*Math.pow(2,(n-49)/12))},t}();t.tsw.music=new e}(window);